**注意：本批处理涉及到的文件全部为ANSI编码，其他编码会造成乱码或者无法运行！**

本批处理需要两个外部命令：`aria2c.exe` `wfr.exe`

aria2c.exe 下载地址：http://sourceforge.net/projects/aria2/files/stable/

wfr.exe 下载地址：http://baiy.cn/utils/wfr/wfr.rar

首次使用需要对批处理和Aria2配置，按照提示输入即可，批处理有做默认配置，也可以直接一路回车跳过。

注：对本批处理来说，提示输入的时候直接回车表示跳过此项设置，有部分设置是不允许跳过的。

**批处理功能配置部分：**

 1. Aria2有限速功能，可以防止在下载的时候网络太卡，开启后每次打开批处理会提示输入限速值，直接回车跳过的话则使用配置文件中的`default_speed`值，若填0的话则表示不限速。

 2. 为了不需要每次都输入下载链接和文件名，可以使用下载列表，下载列表文件名默认为`down.lst`，下载列表内容格式为每行一个任务，文件名和下载链接使用`\`分割，如：`filename.txt\http://example.com/path/file.txt\gdriveid`，可以使用`#`来做注释，批处理会自动跳过`#`开头的行，下载文件的编码为ANSI，其他格式会报错。

 3. 指定时间段下载完成后关机功能，夜晚挂机下载可以使用此功能，在此时间段内下载完成全部任务后批处理会关闭计算机。时间段需要开始时间和结束时间，根据自己需要填写即可。

配置文件`AdmX.ini`可以在日后根据需要修改选项

**Aria2配置部分：**

 1. `Aria2 v1.16`后版本可以使用磁盘缓存功能，可以在一定程度上减少磁盘读写次数，这个可以根据下载速度填写，不建议设置过大，以免出错中断造成数据损失。

 2. 文件预分配功能就是指在下载开始之前预先在磁盘划出文件所需要的空间，可以有效减少磁盘碎片，缺点是需要消耗时间，NTFS格式磁盘可以使用`falloc`方式，速度比较快，FAT32格式磁盘预分配需要很长时间，建议使用`none`选项关闭此功能。

 3. 同一服务器连接数值和单文件最大线程数和连接相关配置，根据自己需要修改，一般默认即可。

配置完成后即可使用本批处理了。Aria2还有许多选项可以配置，一般使用的话默认足够。

详细的配置可以自行修改`aria2.conf`文件，参数可以参考aria2的manual ：http://aria2.sourceforge.net/manual/en/html/aria2c.html 。

**关于下载列表的使用：**

你需要安装`ThunderAssistant.user.js`脚本对离线下载链接进行提取 ，点击右侧`View Raw`按钮即可安装，安装完成后离线页面会出现`提取地址`菜单，勾选需要下载的任务后，点击`提取地址`菜单即可输出合适的格式了，直接复制粘贴进下载列表即可。

右下角的`保存为文件`可以保存下载列表，但是注意此列表为UTF-8编码，需要转换为ANSI编码才能使用。

**关于下载完成关机功能：**

开启此功能后如果完成时间在“下载关机时间段结束时间”之后的话则直接退出，否则则会判断当前时间是否在“下载关机时间段”之内，如果早于此时间段则会等待5分钟后重新检查，直到在“下载关机时间段”之内，在启动关机命令之前有10秒钟的等待时间。

- [x] xl
- [ ] xl